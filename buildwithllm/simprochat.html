<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SimProChat</title>
<style>
html, body {height: 100%; overflow: hidden;} 
body {font-family: Arial, sans-serif; margin: 0; padding: 0; display: flex; flex-direction: column; background: #f0f0f0; height: 100vh;} 
pre {margin: 0;} 
#apiKeySection {padding: 10px; background: #e0e0e0; border-bottom: 1px solid #ccc;} 
#mainContent {display: flex; flex: 1; overflow: hidden;} 
#mainColumn {flex: 1; display: flex; flex-direction: column; padding: 10px; background: #fff;} 
#sidebar {width: 300px; padding: 10px; display: flex; flex-direction: column; overflow-y: auto; background: #fff; transition: width 0.3s ease;} 
#sidebar.hidden {width: 0; padding: 0; overflow: hidden;} 
#sidebarToggle {width: 5px; background: #007bff; cursor: pointer; transition: background 0.3s ease;} 
#sidebarToggle:hover {background: #0056b3;} 
.chatRow {display: flex; justify-content: space-between; align-items: center; margin-bottom: 3px; padding: 3px; border-radius: 5px; position: relative;} 
.editableText {line-height: 1.2; border: 1px solid transparent; padding: 5px; border-radius: 3px; display: inline-block; cursor: default; width: calc(100% - 10px); white-space: pre-wrap; word-wrap: break-word;} 
.editableText:focus {outline: none;} 
.editingMode {border: 2px solid #007bff; border-radius: 5px; padding: 5px; cursor: text;} 
.messageRole {font-weight: bold; margin-bottom: 5px; display: block;} 
#zeroshotHistory {margin-top: 10px; max-height: 300px; overflow-y: auto;} 
textarea, input {width: 100%; box-sizing: border-box; padding: 5px; border: 1px solid #ccc; border-radius: 3px; margin-bottom: 5px;} 
#chatHistory {flex: 1; overflow-y: auto; margin-bottom: 10px;} 
#chatInput {padding: 10px; border-top: 1px solid #ccc;} 
#errorMessage {color: red; padding: 10px;} 
button {padding: 5px 10px; background: #007bff; color: #fff; border: none; border-radius: 3px; cursor: pointer;} 
button:hover {background: #0056b3;} 
.copyButton {position: absolute; top: 5px; right: 5px; background: white; color: #007bff; border: 1px solid #007bff; border-radius: 3px; padding: 2px 5px; cursor: pointer; font-size: 12px;} 
.copyButton:hover {background: #007bff; color: white;} 
@keyframes spin {0% {transform: rotate(0deg);} 100% {transform: rotate(360deg);}} 
.loadingSpinner {display: inline-block; width: 10px; height: 10px; border: 2px solid rgba(255, 255, 255, .3); border-radius: 50%; border-top-color: #fff; animation: spin 1s ease-in-out infinite; margin-right: 5px;} 
button:disabled {opacity: 0.7; cursor: not-allowed;} 
#youtubeSection {margin-bottom: 10px;} 
#youtubeFrame {width: 100%; height: 200px; border: none;} 
#youtubeUrl {text-align: left;} 
@media (max-width: 768px) {#mainContent {flex-direction: column;} #sidebar {width: 100%;}} 
pre.codeblock {background-color: #f4f4f4; border-radius: 3px; padding: 20px 10px; position: relative; white-space: pre-wrap; word-wrap: break-word; overflow-x: auto; margin-top: 5px;} 
pre.codeblock code {font-family: 'Courier New', Courier, monospace; font-size: 14px; display: block; padding-top: 5px;} 
.codeLanguage {font-size: 0.8em; color: #888; position: absolute; top: 0; left: 0; padding: 2px 5px; background: #e0e0e0; border-bottom-right-radius: 3px; border-right: 1px solid #ddd; border-bottom: 1px solid #ddd;} 
.copyButton {position: absolute; top: 5px; right: 5px; background: white; color: #007bff; border: 1px solid #007bff; border-radius: 3px; padding: 2px 5px; cursor: pointer; font-size: 12px;} 
.copyButton:hover {background: #007bff; color: white;} 
.previewButton {position: absolute; bottom: 5px; right: 5px; background: white; color: green; border: 1px solid green; border-radius: 3px; padding: 2px 5px; cursor: pointer; font-size: 12px;} 
.previewButton:hover {background: green; color: white;}
</style>
</head>
<body>
<div id="apiKeySection"><input type="password" id="apiKeyInput" placeholder="Enter your API key" oninput="saveApiKey()"></div>
<div id="mainContent">
  <div id="mainColumn">
    <div id="chatHistory"></div>
    <div id="chatInput">
      <textarea id="userInput" rows="3" placeholder="Enter your message... (Press Enter to send, Shift+Enter for new line)"></textarea>
      <button id="sendButton" onclick="sendMessage()">Send</button>
    </div>
  </div>
  <div id="sidebarToggle" onclick="toggleSidebar()"></div>
  <div id="sidebar">
    <div id="youtubeSection">
      <input type="text" id="youtubeUrl" value="https://www.youtube.com/embed/jfKfPfyJRdk?autoplay=1" placeholder="Enter YouTube embed URL" oninput="updateYoutubeUrl()">
      <iframe id="youtubeFrame" src="https://www.youtube.com/embed/jfKfPfyJRdk?autoplay=1" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen></iframe>
    </div>
    <h3>Zero-shot Query</h3>
    <input type="text" id="zeroshotSystemPrompt" placeholder="Explain this in fewer words" value="Explain this in fewer words" style="margin-bottom: 10px; width: 100%; box-sizing: border-box;">
    <div style="display: flex; align-items: center;">
      <textarea id="zeroshotInput" placeholder="Enter your zero-shot query..." style="flex-grow: 1; margin-top: 5px; min-height: 41px; height: 41px; box-sizing: border-box;"></textarea>
      <button id="zeroshotButton" onclick="sendZeroshotQuery()" style="min-height: 40px; height: 40px; box-sizing: border-box; margin-left: 5px;">Ask</button>
    </div>
    <div id="zeroshotHistory"></div>
  </div>
</div>
<div id="errorMessage"></div>
<script>
const apiUrl='https://api.openai.com/v1/chat/completions'; 
let chatHistory=[], zeroshotHistory=[], isMainChatProcessing=false, isZeroshotProcessing=false; 
let DEFAULT_SYSTEM_PROMPT="Response in fewer words, be concise and honest."; 
function saveApiKey(){localStorage.setItem('simproChatApiKey', document.getElementById('apiKeyInput').value);} 
function getApiKey(){return localStorage.getItem('simproChatApiKey') || '';} 
function loadApiKey(){document.getElementById('apiKeyInput').value = getApiKey();} 
function escapeHtml(html){return html.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#39;');} 
function formatContent(content){let parts=[], lastIndex=0, codeBlockRegex=/```(\w+)?\n([\s\S]*?)```/g, match; 
  while((match=codeBlockRegex.exec(content)) !== null) {
    if(match.index > lastIndex){parts.push(escapeHtml(content.substring(lastIndex, match.index)));} 
    const lang=match[1] || 'plaintext', code=match[2], previewButton=lang==='html'?'<button class="previewButton" onclick="previewHTML(this)">Preview</button>':''; 
    parts.push(`<pre class="codeblock"><div class="codeLanguage">${lang}</div><code>${escapeHtml(code)}</code><button class="copyButton" onclick="copyCode(this)">Copy</button>${previewButton}</pre>`); 
    lastIndex=codeBlockRegex.lastIndex;
  } 
  if(lastIndex < content.length){parts.push(escapeHtml(content.substring(lastIndex)));} 
  return parts.join('');
} 
function previewHTML(button){const codeElement=button.closest('pre').querySelector('code'); const newWindow=window.open('', '_blank'); newWindow.document.write(codeElement.textContent.trim()); newWindow.document.close();} 
function createMessageElement(content, role, index){const div=document.createElement('div'); div.className='chatRow'; 
  const contentDiv=document.createElement('div'); contentDiv.className='editableText normal'; contentDiv.contentEditable=true; contentDiv.innerHTML=`<span class="messageRole">${role}:</span><div>${formatContent(content)}</div>`; 
  let isEditing=false; contentDiv.addEventListener('dblclick', e=>{if(!isEditing){isEditing=true; contentDiv.textContent=content; contentDiv.classList.add('editingMode'); contentDiv.focus(); e.stopPropagation();}}); 
  contentDiv.addEventListener('keydown', e=>{if(e.key==='Escape')finishEditing();}); document.addEventListener('click', e=>{if(isEditing && !contentDiv.contains(e.target))finishEditing();}); 
  function finishEditing(){isEditing=false; content=contentDiv.textContent.trim(); contentDiv.classList.remove('editingMode'); contentDiv.innerHTML=`<span class="messageRole">${role}:</span><div>${formatContent(content)}</div>`; if(index>=0)chatHistory[index].content=content; else DEFAULT_SYSTEM_PROMPT=content;} 
  div.appendChild(contentDiv); return div;
} 
function updateChatDisplay(){const chatHistoryDiv=document.getElementById('chatHistory'); chatHistoryDiv.innerHTML=''; chatHistoryDiv.appendChild(createMessageElement(DEFAULT_SYSTEM_PROMPT,"system",-1)); chatHistory.forEach((msg, index)=>chatHistoryDiv.appendChild(createMessageElement(msg.content,msg.role,index))); chatHistoryDiv.scrollTop=chatHistoryDiv.scrollHeight;} 
function updateZeroshotDisplay(){const zeroshotHistoryDiv=document.getElementById('zeroshotHistory'); zeroshotHistoryDiv.innerHTML=zeroshotHistory.map(item=>escapeHtml(item.assistant)).reverse().join('<br><br>');} 
function copyCode(button){navigator.clipboard.writeText(button.closest('pre').querySelector('code').textContent); button.textContent='Copied'; setTimeout(()=>button.textContent='Copy', 1600);} 
function updateYoutubeUrl(){document.getElementById('youtubeFrame').src=`${document.getElementById('youtubeUrl').value}${document.getElementById('youtubeUrl').value.includes('?')?'&':'?'}autoplay=1`;} 
function toggleSidebar(){document.getElementById('sidebar').classList.toggle('hidden');} 
async function sendMessage(){if(isMainChatProcessing)return; const userInput=document.getElementById('userInput'); if(userInput.value.trim()==='')return; chatHistory.push({role:"user", content:userInput.value}); updateChatDisplay(); userInput.value=''; 
  try {isMainChatProcessing=true; setButtonLoadingState('sendButton',true); const response=await fetchAIResponse([{role:"system",content:DEFAULT_SYSTEM_PROMPT},...chatHistory]); chatHistory.push({role:"assistant",content:response}); updateChatDisplay();}
  catch(error){document.getElementById('errorMessage').textContent=`Error: ${error.message}`;}
  finally {isMainChatProcessing=false; setButtonLoadingState('sendButton',false);}
}
async function sendZeroshotQuery(){if(isZeroshotProcessing)return; const zeroshotInput=document.getElementById('zeroshotInput'); if(zeroshotInput.value.trim()==='')return; 
  try {isZeroshotProcessing=true; setButtonLoadingState('zeroshotButton',true); const response=await fetchAIResponse([{role:"system",content:document.getElementById('zeroshotSystemPrompt').value},{role:"user",content:zeroshotInput.value}]); 
    zeroshotHistory.push({system:document.getElementById('zeroshotSystemPrompt').value, user:zeroshotInput.value, assistant:response}); updateZeroshotDisplay(); zeroshotInput.value='';}
  catch(error){document.getElementById('errorMessage').textContent=`Error: ${error.message}`;}
  finally {isZeroshotProcessing=false; setButtonLoadingState('zeroshotButton',false);}
}
const setButtonLoadingState = (buttonId, isLoading) => { const button = document.getElementById(buttonId); button.disabled = isLoading; isLoading ? (button.dataset.text = button.innerHTML, button.innerHTML = '<span class="loadingSpinner"></span>') : button.innerHTML = button.dataset.text; };
async function fetchAIResponse(messages){const apiKey=getApiKey(); if(!apiKey)throw new Error('API key not set. Please enter your API key.'); 
  const response=await fetch(apiUrl,{method:'POST',headers:{'Content-Type':'application/json','Authorization':`Bearer ${apiKey}`},body:JSON.stringify({model:"chatgpt-4o-latest",messages:messages,temperature:1})}); 
  if(!response.ok){const errorData=await response.json(); throw new Error(`API error: ${errorData.error.message}`);} 
  const data=await response.json(); return data.choices[0].message.content;
}
window.onload=function(){loadApiKey(); updateChatDisplay(); document.getElementById('userInput').addEventListener('keydown',e=>{if(e.key==='Enter'&&!e.shiftKey){e.preventDefault();sendMessage();}});}
</script>
</body>
</html>